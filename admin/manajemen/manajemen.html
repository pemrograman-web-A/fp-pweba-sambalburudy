<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Produk - Admin Bu Rudy (Final DOM Manipulation)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
    // Konfigurasi Tailwind CSS (tetap sama)
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    burudy: {
                        red: '#B91C1C',
                        gold: '#F59E0B',
                        dark: '#1F2937',
                        light: '#FEF2F2',
                        green: '#059669' 
                    }
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                    serif: ['Playfair Display', 'serif'],
                }
            }
        }
    }
    
    // Global Variables
    let currentMode = 'create'; 
    let currentEditingId = null; 
    const API_URL = 'api.php'; // Ganti jika nama file atau lokasi API berbeda

    // --- FUNGSI PEMBANTU ---
    function formatRupiah(number) {
        return 'Rp ' + parseInt(number).toLocaleString('id-ID');
    }

    function getStatusSpan(stock) {
        let text = 'Aktif';
        let color = 'bg-burudy-green/20 text-burudy-green';
        if (stock < 50) {
            text = 'Stok Rendah';
            color = 'bg-orange-100 text-orange-600';
        } else if (stock <= 0) {
            text = 'Habis';
            color = 'bg-red-100 text-red-600';
        }
        return `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${color}">${text}</span>`;
    }

    // Membuat baris HTML dari objek produk
    function createNewRow(product) {
        const { id, name, price, stock } = product;
        const formattedPrice = formatRupiah(price);
        const statusSpan = getStatusSpan(stock);

        const tr = document.createElement('tr');
        tr.setAttribute('data-id', id);
        
        tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${id}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-burudy-red font-semibold">${formattedPrice}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${stock}</td>
            <td class="px-6 py-4 whitespace-nowrap">${statusSpan}</td>
            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                <button onclick="openForm('edit', '${id}', '${name}', '${price}', '${stock}')" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-edit"></i> Edit</button>
                <button onclick="handleDelete('${id}', '${name}')" class="text-burudy-red hover:text-red-900"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `;
        return tr;
    }

    // --- FUNGSI UTAMA (API Interaction) ---

    // READ: Memuat data dari API saat halaman dimuat
    async function loadProducts() {
        const tableBody = document.querySelector('#product-table tbody');
        tableBody.innerHTML = ''; // Kosongkan tabel
        
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error('Gagal memuat data dari API.');
            
            const products = await response.json();
            
            products.forEach(product => {
                tableBody.appendChild(createNewRow(product));
            });
        } catch (error) {
            alert('Error saat memuat produk: ' + error.message);
        }
    }
    
    // DELETE: Menghapus produk melalui API
    async function handleDelete(productId, productName) {
        if (confirm(`⚠️ Apakah Anda yakin ingin menghapus produk "${productName}" (ID: ${productId})?`)) {
            try {
                const response = await fetch(`${API_URL}?id=${productId}`, {
                    method: 'DELETE',
                });
                
                const result = await response.json();

                if (response.ok) {
                    alert(`✅ Sukses: ${result.message}`);
                    loadProducts(); // Muat ulang data
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                alert('Error Hapus: ' + error.message);
            }
        }
    }

    // CREATE/UPDATE: Menyimpan data melalui API
    async function handleSave() {
        const productName = document.getElementById('nama').value;
        const productPrice = document.getElementById('harga').value;
        const productStock = document.getElementById('stok').value;
        
        if (!productName || !productPrice || !productStock) {
            alert('Gagal: Harap isi semua kolom wajib!');
            return;
        }

        const data = {
            name: productName,
            price: parseInt(productPrice),
            stock: parseInt(productStock)
        };
        
        let apiEndpoint = API_URL;
        let method = 'POST';

        if (currentMode === 'edit' && currentEditingId) {
            method = 'PUT';
            apiEndpoint = `${API_URL}?id=${currentEditingId}`;
        }
        
        try {
            const response = await fetch(apiEndpoint, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });
            
            const result = await response.json();

            if (response.ok) {
                alert(`✅ Sukses: ${result.message}`);
                closeForm();
                loadProducts(); // Muat ulang data
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            alert(`Error Simpan: ${error.message}`);
        }
    }

    // --- FUNGSI UI (tetap sama, hanya pemanggilan CRUD Logic yang berbeda) ---
    
    function openForm(mode, productId = null, productName = null, productPrice = null, productStock = null) {
        const formTitle = document.getElementById('form-title');
        const productForm = document.getElementById('product-form');
        const modal = document.getElementById('product-modal');
        currentMode = mode;
        currentEditingId = productId; 

        if (mode === 'create') {
            formTitle.innerText = 'Tambah Produk Baru';
            productForm.reset(); 
        } else if (mode === 'edit') {
             formTitle.innerText = `Edit Produk: ${productName}`;
             document.getElementById('nama').value = productName;
             // Harga dan Stok diisi langsung angka untuk input type="number"
             document.getElementById('harga').value = productPrice; 
             document.getElementById('stok').value = productStock; 
        }
        modal.classList.remove('hidden');
    }

    function closeForm() {
        document.getElementById('product-modal').classList.add('hidden');
        currentEditingId = null;
    }

    // Panggil saat halaman selesai dimuat
    document.addEventListener('DOMContentLoaded', loadProducts);
</script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="font-sans text-burudy-dark bg-gray-100 antialiased">

    <nav class="bg-burudy-dark text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <span class="font-serif text-xl font-bold text-burudy-gold tracking-wide">Bu Rudy Admin</span>
                    <span class="ml-4 text-gray-400">/ Manajemen Produk</span>
                </div>
                <a href="/admin.html" class="bg-burudy-red text-white px-3 py-1 rounded-full text-sm font-medium hover:bg-red-800 transition">Dashboard</a>
            </div>
        </div>
    </nav>

    <main class="py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-serif font-bold text-burudy-dark mb-6">Manajemen Produk (CRUD)</h1>
            
            <div class="flex justify-end mb-6">
                <button 
                    onclick="openForm('create')"
                    class="bg-burudy-green text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 transition flex items-center gap-2 shadow-md">
                    <i class="fas fa-plus"></i> Tambah Produk Baru
                </button>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200" id="product-table">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ID
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Nama Produk
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Harga
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Stok
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status
                            </th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Aksi (Update & Delete)
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        
                        <tr data-id="BR001">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">BR001</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Sambal Bawang (Tutup Kuning)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-burudy-red font-semibold">Rp 28.000</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">450</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-burudy-green/20 text-burudy-green">Aktif</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                <button onclick="openForm('edit', 'BR001', 'Sambal Bawang (Tutup Kuning)', 'Rp 28.000', '450')" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-edit"></i> Edit</button>
                                <button onclick="handleDelete('BR001')" class="text-burudy-red hover:text-red-900"><i class="fas fa-trash"></i> Hapus</button>
                            </td>
                        </tr>

                        <tr data-id="BR002">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">BR002</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Udang Crispy (Toples Tabung)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-burudy-red font-semibold">Rp 100.000</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-orange-600 font-semibold">25</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-600">Stok Rendah</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                <button onclick="openForm('edit', 'BR002', 'Udang Crispy (Toples Tabung)', 'Rp 100.000', '25')" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-edit"></i> Edit</button>
                                <button onclick="handleDelete('BR002')" class="text-burudy-red hover:text-red-900"><i class="fas fa-trash"></i> Hapus</button>
                            </td>
                        </tr>
                        
                        <tr data-id="BR003">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">BR003</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Spikoe Tanpa Kismis</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-burudy-red font-semibold">Rp 125.000</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">320</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-burudy-green/20 text-burudy-green">Aktif</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                <button onclick="openForm('edit', 'BR003', 'Spikoe Tanpa Kismis', 'Rp 125.000', '320')" class="text-indigo-600 hover:text-indigo-900 mr-4"><i class="fas fa-edit"></i> Edit</button>
                                <button onclick="handleDelete('BR003')" class="text-burudy-red hover:text-red-900"><i class="fas fa-trash"></i> Hapus</button>
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>

        </div>
    </main>

    <div id="product-modal" class="fixed inset-0 z-50 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-burudy-gold/20 sm:mx-0 sm:h-10 sm:w-10">
                <i class="fas fa-box text-burudy-gold"></i>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="form-title">
                  Tambah Produk Baru
                </h3>
                
                <form id="product-form" class="mt-4 space-y-4">
                    <div>
                        <label for="nama" class="block text-sm font-medium text-gray-700">Nama Produk</label>
                        <input type="text" name="nama" id="nama" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                    </div>
                    <div>
                        <label for="harga" class="block text-sm font-medium text-gray-700">Harga (Rp)</label>
                        <input type="number" name="harga" id="harga" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" min="1000" step="1000">
                    </div>
                    <div>
                        <label for="stok" class="block text-sm font-medium text-gray-700">Jumlah Stok</label>
                        <input type="number" name="stok" id="stok" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" min="0">
                    </div>
                    <div>
                        <label for="deskripsi" class="block text-sm font-medium text-gray-700">Deskripsi Singkat</label>
                        <textarea name="deskripsi" id="deskripsi" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea>
                    </div>
                    
                </form>
                </div>
            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button 
                type="button" 
                onclick="handleSave()"
                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-burudy-red text-base font-medium text-white hover:bg-red-800 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
              Simpan Data
            </button>
            <button 
                onclick="closeForm()"
                type="button" 
                class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
              Batal
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-burudy-dark py-4 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm">&copy; 2025 Bu Rudy Admin Panel.</p>
        </div>
    </footer>

</body>
</html>